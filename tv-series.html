<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style-tv-series.css">
    <link rel="shortcut icon" href="logo.png" type="image/x-icon">
    <title>TV Series</title>
</head>

<body>
    <header>
        <nav>
            <div class="logo_ul">
                <img src="logo.png" alt="ZMovies Logo">
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="#" id="series">Series</a></li>
                    <li><a href="#" id="movies">Movies</a></li>
                    <li><a href="#">Kids</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <section id="banner">
        <h1 id="series-title">Loading...</h1>
        <p id="series-overview">Please wait while we fetch the series details.</p>
    </section>

    <main>
        <div id="seasons-container">
            <h2>Seasons</h2>
            <div id="seasons-list">
                <!-- Seasons will be loaded dynamically -->
            </div>
        </div>

        <div id="episodes-container" class="hidden">
            <h2 id="selected-season-title">Episodes</h2>
            <div id="episodes-list">
                <!-- Episodes will be loaded dynamically -->
            </div>
            <button id="back-to-seasons" class="btn-secondary">Back to Seasons</button>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 ZMovies. All rights reserved.</p>
    </footer>

    <script>
        const apiKey = "ef1a1941f096c9755627399fa267b35e";
        const urlParams = new URLSearchParams(window.location.search);
        const tvShowId = urlParams.get("id");
        const seasonsContainer = document.getElementById('seasons-container');
        const episodesContainer = document.getElementById('episodes-container');
        const seasonsList = document.getElementById('seasons-list');
        const episodesList = document.getElementById('episodes-list');
        const seriesTitle = document.getElementById('series-title');
        const seriesOverview = document.getElementById('series-overview');
        const selectedSeasonTitle = document.getElementById('selected-season-title');
        const backToSeasonsButton = document.getElementById('back-to-seasons');

        // Fetch TV series details
        const fetchTVSeriesDetails = async () => {
            const url = `https://api.themoviedb.org/3/tv/${tvShowId}?api_key=${apiKey}&language=en-US`;
            const response = await fetch(url);
            const data = await response.json();
            seriesTitle.textContent = data.name;
            seriesOverview.textContent = data.overview || "No description available.";
            return data.seasons;
        };

        // Fetch episodes for a season
        const fetchSeasonEpisodes = async (seasonNumber) => {
            const url = `https://api.themoviedb.org/3/tv/${tvShowId}/season/${seasonNumber}?api_key=${apiKey}&language=en-US`;
            const response = await fetch(url);
            const data = await response.json();
            return data.episodes;
        };

        // Display seasons
        const displaySeasons = async () => {
            const seasons = await fetchTVSeriesDetails();
            seasonsList.innerHTML = "";
            seasons.forEach(season => {
                const seasonDiv = document.createElement('div');
                seasonDiv.className = "season-card";
                seasonDiv.innerHTML = `
                    <img src="https://image.tmdb.org/t/p/w200${season.poster_path}" alt="${season.name}">
                    <h3>${season.name}</h3>
                    <p>${season.episode_count} Episodes</p>
                    <button class="btn-primary view-episodes" data-season="${season.season_number}">View Episodes</button>
                `;
                seasonsList.appendChild(seasonDiv);
            });

            // Add event listeners to buttons
            const viewEpisodesButtons = document.querySelectorAll('.view-episodes');
            viewEpisodesButtons.forEach(button => {
                button.addEventListener('click', async (e) => {
                    const seasonNumber = e.target.getAttribute('data-season');
                    const episodes = await fetchSeasonEpisodes(seasonNumber);
                    displayEpisodes(episodes, seasonNumber);
                });
            });
        };

        // Display episodes for a season
        const displayEpisodes = (episodes, seasonNumber) => {
            seasonsContainer.classList.add('hidden');
            episodesContainer.classList.remove('hidden');
            selectedSeasonTitle.textContent = `Season ${seasonNumber}`;
            episodesList.innerHTML = "";
            episodes.forEach(episode => {
                const episodeDiv = document.createElement('div');
                episodeDiv.className = "episode-card";
                episodeDiv.innerHTML = `
                    <h4>${episode.name}</h4>
                    <p>Air Date: ${episode.air_date || "N/A"}</p>
                    <p>Runtime: ${episode.runtime || "N/A"} mins</p>
                    <button class="btn-primary" onclick="window.open('https://embed.me/embed/tv/${tvShowId}/${seasonNumber}/${episode.episode_number}', '_blank')">
                        Watch Episode
                    </button>
                `;
                episodesList.appendChild(episodeDiv);
            });
        };

        // Back to seasons view
        backToSeasonsButton.addEventListener('click', () => {
            seasonsContainer.classList.remove('hidden');
            episodesContainer.classList.add('hidden');
        });

        // Load seasons on page load
        displaySeasons();
    </script>
</body>

</html>
